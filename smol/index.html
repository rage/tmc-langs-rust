<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `smol` crate."><meta name="keywords" content="rust, rustlang, rust-lang, smol"><title>smol - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../smol/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate smol</p><div class='block version'><p>Version 0.1.18</p></div><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all smol's items</p></a><div class="block items"><ul><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'smol', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/smol/lib.rs.html#1-135' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>smol</a></span></h1><div class='docblock'><p>A small and fast async runtime.</p>
<h1 id="executors" class="section-header"><a href="#executors">Executors</a></h1>
<p>There are three executors that poll futures:</p>
<ol>
<li>Thread-local executor for tasks created by [<code>Task::local()</code>].</li>
<li>Work-stealing executor for tasks created by [<code>Task::spawn()</code>].</li>
<li>Blocking executor for tasks created by [<code>Task::blocking()</code>], [<code>blocking!</code>], [<code>iter()</code>],
[<code>reader()</code>] and [<code>writer()</code>].</li>
</ol>
<p>Blocking executor is the only one that spawns threads on its own.</p>
<p>See <a href="fn.run.html#examples">here</a> for how to run executors on a single thread or on a thread
pool.</p>
<h1 id="reactor" class="section-header"><a href="#reactor">Reactor</a></h1>
<p>To wait for the next I/O event, the reactor calls <a href="https://en.wikipedia.org/wiki/Epoll">epoll</a> on Linux/Android, <a href="https://en.wikipedia.org/wiki/Kqueue">kqueue</a> on
macOS/iOS/BSD, and <a href="https://github.com/piscisaureus/wepoll">wepoll</a> on Windows.</p>
<p>The [<code>Async</code>] type registers I/O handles in the reactor and is able to convert their blocking
operations into async operations.</p>
<p>The [<code>Timer</code>] type registers timers in the reactor that will fire at the chosen points in
time.</p>
<h1 id="running" class="section-header"><a href="#running">Running</a></h1>
<p>Function [<code>run()</code>] simultaneously runs the thread-local executor, runs the work-stealing
executor, and polls the reactor for I/O events and timers. At least one thread has to be
calling [<code>run()</code>] in order for futures waiting on I/O and timers to get notified.</p>
<p>If you want a multithreaded runtime, just call [<code>run()</code>] from multiple threads. See
<a href="fn.run.html#examples">here</a> for an example.</p>
<p>There is also [<code>block_on()</code>], which blocks the current thread until a future completes, but it
doesn't poll the reactor or run executors. When using [<code>block_on()</code>], make sure at least one
thread is calling [<code>run()</code>], or else I/O and timers will not work!</p>
<p>Blocking tasks run in the background on a dedicated thread pool.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<p>Connect to a HTTP website, make a GET request, and pipe the response to the standard output:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">futures</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">smol</span>::<span class="ident">Async</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">net</span>::<span class="ident">TcpStream</span>;

<span class="kw">fn</span> <span class="ident">main</span>() <span class="op">-&gt;</span> <span class="ident">std</span>::<span class="ident">io</span>::<span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="ident">smol</span>::<span class="ident">run</span>(<span class="kw">async</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">stream</span> <span class="op">=</span> <span class="ident">Async</span>::<span class="op">&lt;</span><span class="ident">TcpStream</span><span class="op">&gt;</span>::<span class="ident">connect</span>(<span class="string">&quot;example.com:80&quot;</span>).<span class="kw">await</span><span class="question-mark">?</span>;
        <span class="kw">let</span> <span class="ident">req</span> <span class="op">=</span> <span class="string">b&quot;GET / HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n&quot;</span>;
        <span class="ident">stream</span>.<span class="ident">write_all</span>(<span class="ident">req</span>).<span class="kw">await</span><span class="question-mark">?</span>;

        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">stdout</span> <span class="op">=</span> <span class="ident">smol</span>::<span class="ident">writer</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">stdout</span>());
        <span class="ident">futures</span>::<span class="ident">io</span>::<span class="ident">copy</span>(<span class="kw-2">&amp;</span><span class="ident">stream</span>, <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">stdout</span>).<span class="kw">await</span><span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(())
    })
}</pre></div>
<p>Look inside the <a href="https://github.com/stjepang/smol/tree/master/examples">examples</a> directory for more:
a <a href="https://github.com/stjepang/smol/blob/master/examples/web-crawler.rs">web crawler</a>,
a <a href="https://github.com/stjepang/smol/blob/master/examples/ctrl-c.rs">Ctrl-C handler</a>,
a TCP <a href="https://github.com/stjepang/smol/blob/master/examples/tcp-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/tcp-server.rs">server</a>,
a TCP chat <a href="https://github.com/stjepang/smol/blob/master/examples/chat-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/chat-server.rs">server</a>,
a TLS <a href="https://github.com/stjepang/smol/blob/master/examples/tls-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/tls-server.rs">server</a>,
an HTTP+TLS <a href="https://github.com/stjepang/smol/blob/master/examples/simple-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/simple-server.rs">server</a>,
an <a href="https://docs.rs/async-h1">async-h1</a> <a href="https://github.com/stjepang/smol/blob/master/examples/async-h1-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/async-h1-server.rs">server</a>,
a <a href="https://docs.rs/hyper">hyper</a> <a href="https://github.com/stjepang/smol/blob/master/examples/hyper-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/hyper-server.rs">server</a>,
and a WebSocket+TLS <a href="https://github.com/stjepang/smol/blob/master/examples/websocket-client.rs">client</a>/<a href="https://github.com/stjepang/smol/blob/master/examples/websocket-server.rs">server</a>.</p>
<p>It's also possible to plug non-async libraries into the runtime: see
<a href="https://github.com/stjepang/smol/blob/master/examples/linux-inotify.rs">inotify</a>, <a href="https://github.com/stjepang/smol/blob/master/examples/linux-timerfd.rs">timerfd</a>, <a href="https://github.com/stjepang/smol/blob/master/examples/unix-signal.rs">signal-hook</a>, and <a href="https://github.com/stjepang/smol/blob/master/examples/windows-uds.rs">uds_windows</a>.</p>
<p>Finally, there's an <a href="https://github.com/stjepang/smol/blob/master/examples/other-runtimes.rs">example</a> showing how to use smol with
<a href="https://docs.rs/async-std">async-std</a>, <a href="https://docs.rs/tokio">tokio</a>, <a href="https://docs.rs/surf">surf</a>, and <a href="https://docs.rs/reqwest">reqwest</a>.</p>
</div><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table><tr class='module-item'><td><a class="macro" href="macro.blocking.html" title='smol::blocking macro'>blocking</a></td><td class='docblock-short'><p>Spawns blocking code onto a thread.</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Async.html" title='smol::Async struct'>Async</a></td><td class='docblock-short'><p>Async I/O.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Task.html" title='smol::Task struct'>Task</a></td><td class='docblock-short'><p>A spawned future.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Timer.html" title='smol::Timer struct'>Timer</a></td><td class='docblock-short'><p>Fires at the chosen point in time.</p>
</td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.block_on.html" title='smol::block_on fn'>block_on</a></td><td class='docblock-short'><p>Blocks on a single future.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.iter.html" title='smol::iter fn'>iter</a></td><td class='docblock-short'><p>Creates a stream that iterates on a thread.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.reader.html" title='smol::reader fn'>reader</a></td><td class='docblock-short'><p>Creates an async reader that runs on a thread.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.run.html" title='smol::run fn'>run</a></td><td class='docblock-short'><p>Runs executors and polls the reactor.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.writer.html" title='smol::writer fn'>writer</a></td><td class='docblock-short'><p>Creates an async writer that runs on a thread.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "smol";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>